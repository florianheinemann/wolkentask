"use strict";

var enforceHTTPS = function(trustProxy) {
	return function(req, res, next) {
console.log(req.method)
		// First, check if directly requested via https
		var isHttps = req.secure;

		// Second, if the request headers can be trusted (e.g. because they are send
		// by a proxy), check if x-forward-proto is set to https
		if(!isHttps && trustProxy) {
			isHttps = (req.headers["x-forwarded-proto"] === "https")
		}

		if(isHttps) {
			next();
		} else {
			// todo: what is in case of POST?
			res.redirect(301, "https://" + req.headers.host + req.originalUrl);
		}
	}
};

exports.HTTPS = enforceHTTPS;